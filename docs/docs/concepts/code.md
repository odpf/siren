# Code Architecture

Start with a birdâ€™s eye overview of the problem being solved.

Siren is web service which simplifies alerting for a wide range of application. It provides a simple interface to manage
Cortex Rules and Alertmanager configuration.

This document describes the high-level code architecture of Siren. If you want to familiarize yourself with the code
base, you are just in the right place!

## Bird's Eye View

![Siren Architecture](/img/siren.jpg)

**Input:** Siren takes user input either from HTTP APIs in request body or YAML files from CLI Commands.

**Output:** The output is DB state change and/or Cortex Rule Group updates or Cortex Alert Manager configuration.

Siren HTTP APIs call cortex endpoints to carry out the required tasks.

## Code map

This section talks briefly about various important directories and data structures.

**Build:** Siren uses `make` to perform various build and alike operations. See `Makefile` for list of options.

**`.github/`**

Github workflow management for releasing a build.

**`main.go`**

Entry point for the application where cobra CLI commander is initialized.

**`cmd/`**

Contains list of commands which Siren CLI can server. Each file here typically asks `app` to load configs and passes
them to appropriate functions inside `app` package. For example: Loading configs and passing them to start web server.

**`app/config.go`**

Loads config by reading the `config.yaml` file and env variables. Precedence is given to ENV variables.

**`app/server.go`**

Starts a Golang application server with cortex ruler, alertmanager and Siren Service host configurations.

It also takes care of running the Migrations by delegating it to `service`

**`service/`**

Service container initialized services from packages defined inside `pkg/`

It also runs migrations by delegating the calls to `services` of packages defined inside `pkg/`

**`store/`**
Initializes new databases instance.

**`api/`**
This holds `gorilla/mux` router and handlers for functionalities provided by packages defined inside `pkg/` over HTTP.

**`pkg/`**
Contains the libraries which perform CRUD over specific resources. For example templates, rules etc.

Let's take an example of what each file denotes.

template package holds model, repository and service to perform CRUD over template resource.
`model.go` holds the data definition, `repository.go` uses data models defined inside model to perform database
operations. `service.go` is the interface between `app` and the `pkg/templates`. It performs data type conversion.

`service` allows `api` to choose any data representation (defined inside `domain/`) and still be use the CRUD
functionality provided by `pkg/templates` package.

**`domain`**
Defines the user facing data representation of the various resources. It also defines the interface for operations on
these resources in `service`. Structures inside `pkg` implement this interface.

**`client`**

It is the autogenerated HTTP Client for Siren APIs generated from the swagger schema of Siren APIs
using [swagger-codegen](https://github.com/swagger-api/swagger-codegen), and it is used inside CLI command `upload` to
call the Siren APIs. It serves as Siren SDK for Golang applications. This should be regenerated when API contact
updates.

**`docs`**

Swagger schema specification and project documentation is held here. The golang files inside here are parsed to generate
swagger schema using DSL defined by [go-swagger](https://goswagger.io/use/spec/meta.html)
