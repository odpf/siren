system:
  - name: cpu-usage
    rules:
      - alert: cpu high warning
        expr: avg by (host, environment) (cpu_usage_user{cpu="cpu-total"}) > 85
        for: 5m
        labels:
          alertname: CPU usage has been above 85 for last 5m {{ $labels.host }}
          environment: "{{ $labels.environment }}"
          severity: WARNING
          team: raystack-infra-2
        annotations:
          dashboard: https://dashboard.raystack.io/xxx
          metric_name: cpu_usage_user
          metric_value: '{{ printf "%0.2f" $value }}'
          resource: "{{ $labels.host }}"
          summary: CPU usage has been {{ printf "%0.2f" $value }} for last 5m on host {{ $labels.host }}
          template: cpu-usage
      - alert: cpu high critical
        expr: avg by (host, environment) (cpu_usage_user{cpu="cpu-total"}) > 90
        for: 5m
        labels:
          alertname: CPU usage has been above 90 for last 5m {{ $labels.host }}
          environment: "{{ $labels.environment }}"
          severity: CRITICAL
          team: raystack-infra-2
        annotations:
          dashboard: https://dashboard.raystack.io/xxx
          metric_name: cpu_usage_user
          metric_value: '{{ printf "%0.2f" $value }}'
          resource: "{{ $labels.host }}"
          summary: CPU usage has been {{ printf "%0.2f" $value }} for last 5m on host {{ $labels.host }}
          template: cpu-usage
  - name: cpu-usage-very-critical
    rules:
      - alert: cpu very high critical
        expr: avg by (host, environment) (cpu_usage_user{cpu="cpu-total"}) > 90
        for: 5m
        labels:
          alertname: CPU usage has been above 90 for last 5m {{ $labels.host }}
          environment: "{{ $labels.environment }}"
          severity: CRITICAL
          team: raystack-infra-2
        annotations:
          dashboard: https://dashboard.raystack.io/xxx
          metric_name: cpu_usage_user
          metric_value: '{{ printf "%0.2f" $value }}'
          resource: "{{ $labels.host }}"
          summary: CPU usage has been {{ printf "%0.2f" $value }} for last 5m on host {{ $labels.host }}
          template: cpu-usage
